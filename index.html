<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Public Art Mapper</title>
  <style>
      html, body, #viewDiv {
          padding: 0;
          margin: 0;
          height: 100%;
          width: 100%;
      }

      header {
          background-color: #c99000;
          color: white;
          text-align: center;
          padding: 10px 0;
          font-family: Arial, sans-serif;
          font-size: 18px;
          font-weight: bold;
          position: fixed;
          top: 0;
          width: 100%;
          z-index: 20;
      }

      .feedBox {
          position: absolute;
          bottom: 10px;
          left: 10px;
          background-color: #ffffff;
          color: #333333;
          padding: 16px;
          border-radius: 8px;
          width: 300px;
          font-family: Arial, sans-serif;
          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
          z-index: 20;
          overflow-y: auto;
          max-height: 250px;
      }
  </style>
  <link rel="stylesheet" href="https://js.arcgis.com/4.26/esri/themes/light/main.css" />
  <script src="https://js.arcgis.com/4.26/"></script>
  <script>
      document.addEventListener("DOMContentLoaded", () => {
          require(["esri/config", "esri/Map", "esri/views/MapView", "esri/layers/FeatureLayer"], 
          (esriConfig, Map, MapView, FeatureLayer) => {
              esriConfig.apiKey = "AAPTxy8BH1VEsoebNVZXo8HurGOndvn56RaIuEG-ymH-92haus5XOWjwfQcNHTRTeMO7efrrwIO_P1WvjAaKi6OQjJ3GIY_futaMIJKN2YL-EYHTHG9Rv2I800yOHi-R0CETmNtIv1jHJiXDbTrmTiJeXLEP-6WMH6Zj1mNwmZT3z5l5nB_2nXXSVTEuDcqBFo737s7VpsbqFXNy4GrGXkfT9juBGmdeoQdWJ8oZqkquRShfozv5LIG5tRroi4bCPx5GAT1_IuAFCiIJ";
              const map = new Map({ basemap: "streets" });
              const view = new MapView({
                  container: "viewDiv",
                  map: map,
                  center: [-98.5795, 39.8283],
                  zoom: 4
              });

              const layer = new FeatureLayer({
                  url: "https://services.arcgis.com/LBbVDC0hKPAnLRpO/arcgis/rest/services/survey123_15532538214a405c94a5d719afc09246_results/FeatureServer/0",
                  outFields: ["give_me_it_a_name", "Description"],
                  returnAttachments: true
              });
              map.add(layer);

              function updateFeed() {
                  layer.queryFeatures({
                      where: "1=1",
                      outFields: ["give_me_it_a_name", "Description"],
                      returnGeometry: false,
                      orderByFields: ["objectid DESC"],
                      num: 3
                  }).then((result) => {
                      const feedList = document.getElementById("feedList");
                      feedList.innerHTML = "";
                      result.features.forEach(feature => {
                          const { give_me_it_a_name, Description, OBJECTID } = feature.attributes;
                          layer.queryAttachments({
                              objectIds: [OBJECTID]
                          }).then(attachments => {
                              let imageUrl = "";
                              if (attachments[OBJECTID] && attachments[OBJECTID].length > 0) {
                                  imageUrl = attachments[OBJECTID][0].url;
                              }
                              const listItem = document.createElement("li");
                              listItem.innerHTML = `<strong>${give_me_it_a_name || "Untitled"}</strong><br>${Description || "No description."}<br>${imageUrl ? `<img src="${imageUrl}" style="max-width:100%;border-radius:4px;margin-top:8px;">` : ""}`;
                              feedList.appendChild(listItem);
                          });
                      });
                  }).catch(error => console.error("Error querying features:", error));
              }

              view.when(() => {
                  updateFeed();
                  setInterval(updateFeed, 60000);
              });
          });
      });
  </script>
</head>
<body>
  <header>Public Art Project</header>
  <div id="viewDiv"></div>
  <div class="feedBox">
      <h2>Recent Additions</h2>
      <ul id="feedList"></ul>
  </div>
</body>
</html>
